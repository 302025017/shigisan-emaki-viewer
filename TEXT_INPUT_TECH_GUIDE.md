# テキスト入力式の実装で使用した技術まとめ

## 1. 目的
プルダウン選択式からテキスト入力式に切り替えたことで、利用者が自由に質問文を入力できるようになりました。本資料は、その実装に使った技術と仕組みを分かりやすく整理したものです。

## 2. 全体の流れ
1. ユーザーがテキストを入力
2. JavaScriptが入力値を取得し、APIへ送信
3. Flaskが受信した質問文を正規化
4. 類似度マッチングで最も近い質問を検索
5. 対応する回答をJSONで返却
6. JavaScriptが画面に回答を表示

## 3. フロントエンドで使った技術

### 3.1 HTML: テキスト入力欄
- input要素を使って自由入力欄を設置
- プレースホルダーで入力内容の例を提示
- 場面未選択時は入力を無効化

### 3.2 JavaScript: イベント制御
- 送信ボタンのクリックで質問を送信
- Enterキーでも送信できるようにイベントを追加
- 送信中は入力欄を一時的に無効化し、二重送信を防止

### 3.3 JavaScript: 通信処理
- Fetch APIを使い、JSON形式でサーバーへ送信
- サーバーからの回答を受け取ってチャット欄に追加
- エラー時はユーザー向けのメッセージを表示

## 4. バックエンドで使った技術

### 4.1 FlaskによるAPI受け取り
- /api/ask で質問を受け取る
- JSON形式で質問文と場面IDを取得
- 空文字や未選択のチェックを実施

### 4.2 入力の正規化
- 前後の空白と改行を除去
- 入力のブレを減らし、マッチング精度を安定させる

### 4.3 類似度マッチング
- TF-IDF（文字n-gram）で質問をベクトル化
- コサイン類似度で最も近い質問を特定
- しきい値以下なら定型文で案内

## 5. 変更点のポイント
- プルダウン式は「用意された質問の選択」だった
- テキスト入力式により「自由入力」が可能になった
- それでも既存の回答データは再利用できる
- 類似度マッチングを使うことで自由入力と固定回答の両立を実現

## 6. 使われた主要技術まとめ
- HTML: input要素
- JavaScript: DOM操作 / イベント制御 / Fetch API
- Flask: ルーティング / JSON入出力
- scikit-learn: TF-IDF / コサイン類似度
- Python: 文字列正規化 / データ管理

## 7. 補足
- 入力式の変更はUI面の改善だけでなく、自由入力と既存データ活用の両立が目的
- 既存の質問データベースをそのまま活かせるため、追加コストが小さい
